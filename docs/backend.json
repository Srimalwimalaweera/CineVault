{
  "entities": {
    "Video": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Video",
      "type": "object",
      "description": "Represents a video in the CineVault platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Video entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the video."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the video content."
        },
        "thumbnailUrl": {
          "type": "string",
          "description": "URL of the video's portrait size thumbnail.",
          "format": "uri"
        },
        "videoUrl": {
          "type": "string",
          "description": "URL where the video can be viewed.",
          "format": "uri"
        },
        "ratings": {
          "type": "number",
          "description": "Average rating of the video.",
          "format": "float"
        },
        "reactionCount": {
          "type": "number",
          "description": "Number of reactions (e.g., likes) for the video."
        },
        "downloadCount": {
          "type": "number",
          "description": "Number of times the video has been downloaded."
        },
        "viewCount": {
          "type": "number",
          "description": "Number of times the video has been viewed."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "thumbnailUrl",
        "videoUrl",
        "ratings",
        "reactionCount",
        "downloadCount",
        "viewCount"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CineVault platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Favorite": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Favorite",
      "type": "object",
      "description": "Represents a video added to a user's favorites.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Favorite entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Favorite)"
        },
        "videoId": {
          "type": "string",
          "description": "Reference to Video. (Relationship: Video 1:N Favorite)"
        }
      },
      "required": [
        "id",
        "userId",
        "videoId"
      ]
    },
    "Playlist": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Playlist",
      "type": "object",
      "description": "Represents a user-created playlist of videos.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Playlist entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Playlist)"
        },
        "name": {
          "type": "string",
          "description": "Name of the playlist."
        },
        "videoIds": {
          "type": "array",
          "description": "References to Videos. (Relationship: Playlist N:N Video)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "videoIds"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/videos/{videoId}",
        "definition": {
          "entityName": "Video",
          "schema": {
            "$ref": "#/backend/entities/Video"
          },
          "description": "Stores video metadata. Accessible for reading by all users. Only admins can create, update, or delete videos.",
          "params": [
            {
              "name": "videoId",
              "description": "Unique identifier for the video document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/favorites/{favoriteId}",
        "definition": {
          "entityName": "Favorite",
          "schema": {
            "$ref": "#/backend/entities/Favorite"
          },
          "description": "Stores a user's favorite videos.  Path-based ownership enforced by {userId}.  No denormalized fields needed.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "favoriteId",
              "description": "Unique identifier for the favorite video entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/playlists/{playlistId}",
        "definition": {
          "entityName": "Playlist",
          "schema": {
            "$ref": "#/backend/entities/Playlist"
          },
          "description": "Stores a user's video playlists. Path-based ownership enforced by {userId}. No denormalized fields needed.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "playlistId",
              "description": "Unique identifier for the playlist."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the CineVault platform, focusing on scalability, security, and ease of management.  The structure leverages path-based ownership for user-specific data (favorites, playlists) and a flat collection for videos.  This design minimizes the need for complex security rules and `get()` calls, ensuring authorization independence. \n\n*   **Videos:** Videos are stored in a flat `/videos` collection.  This simplifies listing and querying videos. No denormalization is needed here as all videos have the same access control requirements (readable by all, writable only by admins - enforced via rules not structure).\n*   **Users:** User data is implicitly stored and managed by Firebase Authentication.\n*   **Favorites:** Each user has a dedicated `/users/{userId}/favorites/{favoriteId}` subcollection for their favorite videos. This structure enforces path-based ownership. This enables QAPs because listing favorites is scoped to the user's subcollection.\n*   **Playlists:** Similar to favorites, playlists are stored in `/users/{userId}/playlists/{playlistId}`. This enforces path-based ownership and allows users to manage their playlists independently.  It also enables QAPs as listing playlists is scoped to the user's subcollection.\n\nThis structure avoids hierarchical authorization dependencies by storing user-specific data in path-based subcollections. Security rules can easily validate `request.auth.uid` against the `userId` parameter in the path. This promotes atomic operations and simplifies debugging."
  }
}
